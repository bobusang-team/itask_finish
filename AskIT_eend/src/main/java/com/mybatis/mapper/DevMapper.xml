<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev">
 
      <!-- Í∞úÎ∞ú ÏßàÎ¨∏ Ï†ÑÏ≤¥ Í≤åÏãúÎ¨º Î¶¨Ïä§Ìä∏  Ï°∞Ìöå -->
   <select id = "selectAllAsk" resultType = "ArticleListDTO">
	<![CDATA[
		SELECT * 
		FROM (
		    SELECT 
		        A.ARTICLE_NUM, 
		        A.ARTICLE_TITLE, 
		        A.ARTICLE_TEXT, 
		        A.ARTICLE_DATE, 
		        A.ARTICLE_VIEW, 
		        A.ARTICLE_MONITOR_NUM, 
		        A.ARTICLE_TOPCATE, 
		        A.ARTICLE_BOTCATE, 
		        A.ARTICLE_TAGNAME, 
		        A.USER_NUM,
		        U.USER_MONITOR,
		        U.USER_NICK,
		        CASE 
		            WHEN U.USER_MENTO_CERT = 'T' THEN 'üèÖ' 
		            ELSE NULL 
		        END AS badge,
		        ROW_NUMBER() OVER (ORDER BY A.ARTICLE_DATE DESC) AS rnum
		    FROM TBL_ARTICLE A
		    INNER JOIN TBL_USER U ON A.USER_NUM = U.USER_NUM
		    WHERE A.ARTICLE_TOPCATE = #{articleTopcate} 
		      AND A.ARTICLE_BOTCATE = #{articleBotcate} 
		) 
		WHERE rnum BETWEEN #{startRow} AND #{endRow}
    ]]>
  </select>
   
       <!-- Í∞úÎ∞ú ÏßàÎ¨∏ Í≤åÏãúÍ∏Ä Ï¥ù Í∞úÏàò -->
   <select id="getTotalDevAsk" resultType="int">
        SELECT COUNT(ARTICLE_NUM) 
        FROM TBL_ARTICLE
       WHERE ((ARTICLE_TOPCATE) = #{articleTopcate} AND (ARTICLE_BOTCATE) = #{articleBotcate})
   </select>
   																													
   
    <!-- Í∞úÎ∞ú ÏßàÎ¨∏ ÌÉúÍ∑∏ÏÑ†ÌÉù Í≤åÏãúÎ¨º Î¶¨Ïä§Ìä∏  Ï°∞Ìöå -->
      <select id = "selectAllAskTag" resultType = "ArticleListDTO">
	<![CDATA[
		SELECT * 
		FROM (
		    SELECT 
		        A.ARTICLE_NUM, 
		        A.ARTICLE_TITLE, 
		        A.ARTICLE_TEXT, 
		        A.ARTICLE_DATE, 
		        A.ARTICLE_VIEW, 
		        A.ARTICLE_MONITOR_NUM, 
		        A.ARTICLE_TOPCATE, 
		        A.ARTICLE_BOTCATE, 
		        A.ARTICLE_TAGNAME, 
		        A.USER_NUM,
		        U.USER_MONITOR,
		        U.USER_NICK,
		        CASE 
		            WHEN U.USER_MENTO_CERT = 'T' THEN 'üèÖ' 
		            ELSE NULL 
		        END AS badge,
		        ROW_NUMBER() OVER (ORDER BY A.ARTICLE_DATE DESC) AS rnum
		    FROM TBL_ARTICLE A
		    INNER JOIN TBL_USER U ON A.USER_NUM = U.USER_NUM
			WHERE ((ARTICLE_TOPCATE) = #{articleTopcate} AND (ARTICLE_BOTCATE) = #{articleBotcate} AND (ARTICLE_TAGNAME) = #{articleTagname})
		) 
		WHERE rnum BETWEEN #{startRow} AND #{endRow}
    ]]>
  </select>
   
   
          <!-- Í∞úÎ∞ú ÏßàÎ¨∏ ÌÉúÍ∑∏ ÏÑ†ÌÉù Í≤åÏãúÍ∏Ä Ï¥ù Í∞úÏàò -->
   <select id="getTotalDevAskTag" resultType="int">
        SELECT COUNT(ARTICLE_NUM) 
        FROM TBL_ARTICLE
        WHERE ((ARTICLE_TOPCATE) = #{articleTopcate} AND (ARTICLE_BOTCATE) = #{articleBotcate} AND (ARTICLE_TAGNAME) = #{articleTagname})
   </select>
   
   
   
  
   
      <!--Í≤åÏãúÎ¨º ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ  Ï°∞Ìöå-->
   <select id = "selectOne" resultType = "ArticleListDTO" parameterType="int">
		SELECT 
		A.ARTICLE_NUM, 
		U.USER_NICK,
		A.ARTICLE_TITLE, 
		A.ARTICLE_TEXT, 
		A.ARTICLE_DATE, 
		A.ARTICLE_VIEW, 
		A.ARTICLE_MONITOR_NUM, 
		A.ARTICLE_TOPCATE, 
		A.ARTICLE_BOTCATE, 
		A.ARTICLE_TAGNAME,
		A.USER_NUM,
		U.USER_MONITOR,
		CASE WHEN USER_MENTO_CERT = 'T' THEN 'üèÖ' END AS badge
		FROM TBL_ARTICLE A
		JOIN TBL_USER U ON A.USER_NUM = U.USER_NUM
		AND A.ARTICLE_NUM = #{articleNum}
   </select>
   
   <!-- BoardMapper.xmlÏóê totalÏùÑ Í∞ÄÏ†∏Ïò§Í∏∞ ÏúÑÌïú ÏøºÎ¶¨ ÏûëÏÑ± -->

   
   
   
   <!--   Í≤åÏãúÎ¨º ÏÇ≠Ï†ú -->
    <delete id ="delete" parameterType = "int">
     DELETE 
     FROM TBL_ARTICLE
     WHERE article_num = #{articleNum}
    </delete>
  
   <!--  Í≤åÏãúÎ¨º ÏàòÏ†ï -->
    <update id="update" parameterType = "ArticleDetailDTO">
      UPDATE 
      TBL_ARTICLE
      SET
	  article_title = #{articleTitle},	
      ARTICLE_TEXT = #{articleText} 
      WHERE article_num = #{articleNum} 
    </update>
   
    <!-- Ï°∞ÌöåÏàò Ï¶ùÍ∞Ä -->
   <update id="increaseView" parameterType = "int">
    UPDATE tbl_article 
    SET  article_view = article_view + 1 
    WHERE article_num = #{articleNum}
   </update> 
   
   <!-- Ï∂îÏ≤úÏàò Ï¶ùÍ∞Ä -->
   <update id="incrementMonitorNum">
    UPDATE TBL_ARTICLE
    SET ARTICLE_MONITOR_NUM = ARTICLE_MONITOR_NUM + 1
    WHERE ARTICLE_NUM = #{articleNum}
	</update>

	<!-- Í≤åÏãúÍ∏Ä Ï∂îÏ≤úÏàò Ï¶ùÍ∞ÄÌï†Ïãú Ïú†Ï†Ä Î™®ÎãàÌÑ∞ Ï¶ùÍ∞Ä  -->
	<update id="incrementUserMonitor">
	UPDATE TBL_USER
    SET USER_MONITOR = USER_MONITOR + 1
    WHERE USER_NUM = #{userNum}
	</update>


<select id="getMonitorNum" resultType="int">
    SELECT ARTICLE_MONITOR_NUM
    FROM TBL_ARTICLE
    WHERE ARTICLE_NUM = #{articleNum}
</select>
   
   
    <select id="comment" parameterType="int" resultType="CommentDTO">
	SELECT 
    C.COMMENT_NUM,                     
    C.USER_NUM,                    
    U.USER_NAME,                     
    U.USER_NICK,                   
    C.COMMENT_TEXT,                 
    C.COMMENT_MONITOR_NUM,         
    C.COMMENT_DATE,             
    U.USER_MONITOR AS USER_MONITOR,
    U.user_nick 
	FROM 
	    TBL_COMMENT C
	JOIN 
	    TBL_USER U ON C.USER_NUM = U.USER_NUM  
	WHERE 
	    C.ARTICLE_NUM = #{articleNum}                  
	ORDER BY 
	    C.COMMENT_DATE DESC       
    </select> 
    
 
	
    
	<insert id="commmentUpdate" parameterType="CommentDTO">
        INSERT INTO TBL_comment (comment_num, comment_text, user_num, comment_date)
        VALUES (#{commentNum}, #{commentText}, #{userNum}, #{commentDate})
    </insert>
	
</mapper>
   

   


   
 


   
   

