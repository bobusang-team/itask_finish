<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">
	<!-- ÎßàÏù¥ÌéòÏù¥ÏßÄ ÏßÑÏûÖÏãú ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ -->
	<!-- userIdÎäî Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú ÏÑ∏ÏÖòÏùò idÍ∞íÏùÑ Í∞ÄÏ†∏ÏôÄ ÏÑ§Ï†ïÌï¥ÏïºÌï® -->
	<!-- userPwÎäî Ìï¥Îãπ formÏóêÏÑú ÏûÖÎ†•Ìïú Ï†ïÎ≥¥Î°ú Í∞ÄÏ†∏ÏôÄ ÏÑ§Ï†ïÌï¥ÏïºÌï® -->
	<select id="pwCheck" parameterType="userDTO" resultType="int">
		SELECT COUNT(*)
		FROM TBL_USER
		WHERE USER_ID = #{userId} AND USER_PW = #{userPw}
	</select>

	<!-- ÎãâÎÑ§ÏûÑ ÏàòÏ†ïÏãú Ï§ëÎ≥µ ÌôïÏù∏ -->
	<select id="nickCheck" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM TBL_USER
		WHERE USER_NICK = #{userNick}
	</select>

	<!-- ÎãâÎÑ§ÏûÑ ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú Ìï¥Îãπ ÌöåÏõê ÏóÖÎç∞Ïù¥Ìä∏ -->
	<!-- userIdÎäî Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú ÏÑ∏ÏÖòÏùò idÍ∞íÏùÑ Í∞ÄÏ†∏ÏôÄ ÏÑ§Ï†ïÌï¥ÏïºÌï® -->
	<!-- userNickÎäî Ìï¥Îãπ formÏóêÏÑú ÏûÖÎ†•Ìïú Ï†ïÎ≥¥Î°ú Í∞ÄÏ†∏ÏôÄ ÏÑ§Ï†ïÌï¥ÏïºÌï® -->
	<update id="nickUpdate" parameterType="userDTO">
		UPDATE TBL_USER
		SET USER_NICK = #{userNick}
		WHERE USER_ID = #{userId}
	</update>

	<!-- ÎπÑÎ∞ÄÎ≤àÌò∏ ÏàòÏ†ïÌïòÍ∏∞ÏóêÏÑú ÎπÑÎ∞ÄÎ≤àÌò∏ ÏàòÏ†ïÌïòÍ∏∞ ÌÅ¥Î¶≠Ïãú -->
	<!-- userIdÎäî Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú ÏÑ∏ÏÖòÏùò idÍ∞íÏùÑ Í∞ÄÏ†∏ÏôÄ ÏÑ§Ï†ïÌï¥ÏïºÌï® -->
	<update id="pwUpdate" parameterType="userDTO">
		UPDATE TBL_USER
		SET USER_PW = #{userPw}
		WHERE USER_ID = #{userId}
	</update>

	<!-- Ìï∏ÎìúÌè∞Î≤àÌò∏ ÏàòÏ†ïÌïòÍ∏∞ÏóêÏÑú Î≥ÄÍ≤ΩÎêú Ï†ïÎ≥¥ Ï†ÄÏû•ÌïòÍ∏∞ ÌÅ¥Î¶≠Ïãú -->
	<!-- userIdÎäî Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú ÏÑ∏ÏÖòÏùò idÍ∞íÏùÑ Í∞ÄÏ†∏ÏôÄ ÏÑ§Ï†ïÌï¥ÏïºÌï® -->
	<update id="phoneUpdate" parameterType="userDTO">
		UPDATE TBL_USER
		SET USER_PHONE = #{userPhone}
		WHERE USER_ID = #{userId}
	</update>


	<!-- ÌöåÏõêÌÉàÌá¥ÌïòÍ∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú -->
	<!-- userIdÎäî Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú ÏÑ∏ÏÖòÏùò idÍ∞íÏùÑ Í∞ÄÏ†∏ÏôÄ ÏÑ§Ï†ïÌï¥ÏïºÌï® -->
	<delete id="delete" parameterType="String">
		DELETE FROM TBL_USER
		WHERE USER_ID = #{userId}
	</delete>
	
	<!-- Ï§ëÎ≥µÍ≤ÄÏÇ¨ -->
	<!-- ÎãâÎÑ§ÏûÑ -->
	<select id='nickCnt' resultType='int'>
		SELECT count (user_nick)
		FROM tbl_user
		WHERE user_nick = #{userNick}
	</select>

	<!-- ÎßàÏù¥ÌéòÏù¥ÏßÄ Î©îÏù∏ ÏßÑÏûÖÏãú -->
	<!-- Ìï¥Îãπ ÌöåÏõêÏùò ÎãâÎÑ§ÏûÑ, Î™®ÎãàÌÑ∞, ÏûëÏÑ±Ìïú Í≤åÏãúÍ∏Ä Ïàò, ÏûëÏÑ±Ìïú ÎåìÍ∏Ä Ïàò, Î±ÉÏßÄÏàò, ÌöåÏõêÏùò Í≤ΩÎ†• Ï°∞Ìöå -->
	<select id="main" parameterType="String" resultType="MypageMainDTO">
		SELECT U.USER_NUM, U.PROFILE_NUM, U.USER_NICK, U.USER_MONITOR, U.USER_MENTO_CERT, U.USER_CAREER,
		T.CERTS_IPE, T.CERTS_IPIE, T.CERTS_IPT, T.CERTS_ISE, T.CERTS_ISIE, T.CERTS_NETMANAGER1, T.CERTS_NETMANAGER2,
		T.CERTS_SQLD, T.CERTS_LINUXMASTER1, T.CERTS_LINUXMASTER2,
		COUNT(DISTINCT A.ARTICLE_NUM) AS ARTICLE_COUNT,
		COUNT(DISTINCT C.COMMENT_NUM) AS COMMENT_COUNT
		FROM TBL_USER U
		LEFT JOIN TBL_ARTICLE A
		ON U.USER_NUM = A.USER_NUM
		LEFT JOIN TBL_COMMENT C
		ON U.USER_NUM = C.USER_NUM
		LEFT JOIN TBL_CERTS T
		ON U.USER_NUM = T.USER_NUM
		WHERE U.USER_ID = #{userId}
		GROUP BY
		U.USER_NUM,
		U.PROFILE_NUM,
		U.USER_NICK,
		U.USER_MONITOR,
		U.USER_MENTO_CERT,
		U.USER_CAREER,
		T.CERTS_IPE,
		T.CERTS_IPIE,
		T.CERTS_IPT,
		T.CERTS_ISE,
		T.CERTS_ISIE,
		T.CERTS_NETMANAGER1,
		T.CERTS_NETMANAGER2,
		T.CERTS_SQLD,
		T.CERTS_LINUXMASTER1,
		T.CERTS_LINUXMASTER2
	</select>
	
	<!-- Ìï¥Îãπ Ïú†Ï†ÄÎ•º ÌÅ¥Î¶≠Ìï† Ïãú -->
	<!-- Ìï¥Îãπ Ïú†Ï†ÄÏùò ÎãâÎÑ§ÏûÑ, Î™®ÎãàÌÑ∞, ÏûëÏÑ±Ìïú Í≤åÏãúÍ∏Ä Ïàò, ÏûëÏÑ±Ìïú ÎåìÍ∏Ä Ïàò, Î±ÉÏßÄÏàò, ÌöåÏõêÏùò Í≤ΩÎ†• Ï°∞Ìöå -->
	<select id="userPage" parameterType="String" resultType="MypageMainDTO">
		SELECT U.USER_NUM, U.PROFILE_NUM, U.USER_NICK, U.USER_MONITOR, U.USER_MENTO_CERT, U.USER_CAREER,
		T.CERTS_IPE, T.CERTS_IPIE, T.CERTS_IPT, T.CERTS_ISE, T.CERTS_ISIE, T.CERTS_NETMANAGER1, T.CERTS_NETMANAGER2,
		T.CERTS_SQLD, T.CERTS_LINUXMASTER1, T.CERTS_LINUXMASTER2,
		COUNT(DISTINCT A.ARTICLE_NUM) AS ARTICLE_COUNT,
		COUNT(DISTINCT C.COMMENT_NUM) AS COMMENT_COUNT
		FROM TBL_USER U
		LEFT JOIN TBL_ARTICLE A
		ON U.USER_NUM = A.USER_NUM
		LEFT JOIN TBL_COMMENT C
		ON U.USER_NUM = C.USER_NUM
		LEFT JOIN TBL_CERTS T
		ON U.USER_NUM = T.USER_NUM
		WHERE U.USER_NICK = #{userNick}
		GROUP BY
		U.USER_NUM,
		U.PROFILE_NUM,
		U.USER_NICK,
		U.USER_MONITOR,
		U.USER_MENTO_CERT,
		U.USER_CAREER,
		T.CERTS_IPE,
		T.CERTS_IPIE,
		T.CERTS_IPT,
		T.CERTS_ISE,
		T.CERTS_ISIE,
		T.CERTS_NETMANAGER1,
		T.CERTS_NETMANAGER2,
		T.CERTS_SQLD,
		T.CERTS_LINUXMASTER1,
		T.CERTS_LINUXMASTER2
	</select>
	
	<!-- ÎÇ¥Í∞Ä Ïì¥ Í≤åÏãúÍ∏Ä Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞ -->
	<select id = "selectAllMyArticle" resultType = "ArticleListDTO">
	<![CDATA[
	SELECT * FROM (
	     SELECT ROWNUM AS rnum, subquery.*
	     FROM (
	      SELECT 
	         A.ARTICLE_NUM, 
	         A.ARTICLE_TITLE, 
	         A.ARTICLE_TEXT, 
	         A.ARTICLE_DATE, 
	         A.ARTICLE_VIEW, 
	         A.ARTICLE_MONITOR_NUM, 
	         A.ARTICLE_TOPCATE, 
	         A.ARTICLE_BOTCATE, 
	         A.ARTICLE_TAGNAME, 
	         A.USER_NUM,
	         U.USER_MENTO_CERT,
	         U.USER_MONITOR,
	         U.USER_NICK,
	         CASE WHEN USER_MENTO_CERT = 'T' THEN 'üèÖ' END AS badge
	      FROM TBL_ARTICLE A
	      JOIN TBL_USER U ON A.USER_NUM = U.USER_NUM
	      WHERE A.USER_NUM = #{userNum}
	      ORDER BY A.ARTICLE_DATE DESC
	   ) subquery
	   ) WHERE rnum BETWEEN #{startRow} AND #{endRow}
	    ]]>
  </select>
  
  <!-- ÎÇ¥Í∞Ä Ïì¥ Í≤åÏãúÍ∏Ä Ïàò Í∞ÄÏ†∏Ïò§Í∏∞ -->
	<select id="getTotalArticleNum" resultType="int">
		SELECT COUNT(ARTICLE_NUM) 
        FROM TBL_ARTICLE
        WHERE USER_NUM = #{userNum}
	</select>
	
  <!--  ÎÇ¥Í∞Ä Ïì¥ ÎåìÍ∏Ä Ïàò Í∞ÄÏ†∏Ïò§Í∏∞ -->
   	<select id="getTotalCommentNum" resultType="int">
		SELECT COUNT(COMMENT_NUM) 
        FROM TBL_COMMENT
        WHERE USER_NUM = #{userNum}
	</select>
	
  <!--  ÎÇ¥Í∞Ä Ïì¥ ÎåìÍ∏Ä Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞ -->
	<select id = "selectAllMyComment" resultType = "MyTotalCommentDTO">
	<![CDATA[
	SELECT * FROM (
	     SELECT ROWNUM AS rnum, subquery.*
	     FROM (
	      SELECT 
	         A.ARTICLE_NUM, 
	         A.ARTICLE_TITLE,     
	         A.ARTICLE_TOPCATE, 
	         A.ARTICLE_BOTCATE, 
	         A.ARTICLE_TAGNAME,
	         A.USER_NUM AS ARTICLE_USER_NUM,
	         U.USER_MENTO_CERT,
	         U.USER_NICK AS ARTICLE_USER_NICK,
	         C.COMMENT_NUM,
	         C.COMMENT_MONITOR_NUM,
	         C.COMMENT_TEXT,
	         C.COMMENT_DATE,
	         C.COMMENT_MODIFY_DATE,
	         CASE WHEN U.USER_MENTO_CERT = 'T' THEN 'üèÖ' END AS badge,
	         UC.USER_NICK AS COMMENT_USER_NICK
	      FROM TBL_ARTICLE A
	      JOIN TBL_USER U ON A.USER_NUM = U.USER_NUM
	      JOIN TBL_COMMENT C ON A.ARTICLE_NUM = C.ARTICLE_NUM
	      JOIN TBL_USER UC ON C.USER_NUM = UC.USER_NUM
	      WHERE C.USER_NUM = #{userNum}
	      ORDER BY C.COMMENT_DATE DESC
	   ) subquery
	   ) WHERE rnum BETWEEN #{startRow} AND #{endRow}
	    ]]>
  </select>
	<!-- fetch ÏÇ¨Ïö©Ïãú Ï£ºÏÑùÌï¥Ï†ú -->
	<!-- <select id="selectCateList" parameterType="map" resultType="ArticleListDTO">
	SELECT 
	A.ARTICLE_NUM,
	A.ARTICLE_TITLE,
	A.ARTICLE_TEXT,
	A.ARTICLE_DATE,
	A.ARTICLE_VIEW,
	A.ARTICLE_MONITOR_NUM,
	A.ARTICLE_TOPCATE,
	A.ARTICLE_BOTCATE,
	A.ARTICLE_TAGNAME,
	U.USER_NICK,
	CASE WHEN USER_MENTO_CERT = 'T' THEN 'üèÖ' END AS badge
	FROM TBL_ARTICLE A
	JOIN TBL_USER U
		ON A.USER_NUM = U.USER_NUM 
	WHERE U.USER_NUM = #{userNum} AND A.ARTICLE_BOTCATE = #{category}
	ORDER BY A.ARTICLE_DATE DESC;
	</select> -->
	
	<!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄÎ™Ö Í∞ÄÏ†∏Ïò§Í∏∞ -->
	<select id="profileSelect" parameterType="int" resultType="String">
	 	SELECT PROFILE_PHOTO 
		FROM TBL_PROFILE
		WHERE PROFILE_NUM = #{profileNum}
	</select>
	
	<!--  Ïú†Ï†Ä ÌÖåÏù¥Î∏îÏùò ÌîÑÎ°úÌïÑNum ÏóÖÎç∞Ïù¥Ìä∏ -->
	<update id="userProfileUpdate" parameterType="int" >
		UPDATE TBL_USER
		SET PROFILE_NUM = #{profileNum}
		WHERE USER_NUM = #{userNum}
	</update>
	
	<!--  Ïú†Ï†Ä ÌÖåÏù¥Î∏î Ï°∞Ìöå -->
	<select id="userSelect" parameterType="int" resultType="UserDTO">
		SELECT *
		FROM TBL_USER
		WHERE USER_NUM = #{userNum}
	</select>
	
	<!--  Ìï¥Îãπ Ïú†Ï†ÄÍ∞Ä ÏûëÏÑ±Ìïú Í≤åÏãúÍ∏Ä ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ Ï°∞Ìöå -->
	<select id = "articleDetail" parameterType="int" resultType = "ArticleListDTO" >
		SELECT 
		A.ARTICLE_NUM, 
		U.USER_NICK,
		A.ARTICLE_TITLE, 
		A.ARTICLE_TEXT, 
		A.ARTICLE_DATE, 
		A.ARTICLE_VIEW, 
		A.ARTICLE_MONITOR_NUM, 
		A.ARTICLE_TOPCATE, 
		A.ARTICLE_BOTCATE, 
		A.ARTICLE_TAGNAME,
		A.USER_NUM,
		U.USER_MONITOR,
		CASE WHEN USER_MENTO_CERT = 'T' THEN 'üèÖ' END AS badge
		FROM TBL_ARTICLE A
		JOIN TBL_USER U ON A.USER_NUM = U.USER_NUM
		AND A.ARTICLE_NUM = #{articleNum}
   </select>
   
   <!--  Ìï¥Îãπ Ïú†Ï†ÄÏùò Í≤åÏãúÍ∏ÄÏùÑ ÌôïÏù∏ÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî ÎãâÎÑ§ÏûÑÏúºÎ°úÎ∂ÄÌÑ∞ Ïú†Ï†ÄÎ≤à
   -Ìò∏Î•º Î∞õÏïÑÏôÄÏïºÌï® -->
   <select id = "getUserNum" parameterType="String" resultType="int">
   		SELECT USER_NUM
   		FROM TBL_USER
   		WHERE USER_NICK = #{userNick}
   </select>
	
</mapper>
